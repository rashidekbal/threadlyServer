CREATE TABLE users (
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL PRIMARY KEY,
  username VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  email VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  phone VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  pass TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  bio VARCHAR(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'I use threadly daily',
  profilepic TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  dob DATE NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  uuid text unique,
  UNIQUE KEY email (email),
  UNIQUE KEY phone (phone)
);

CREATE TABLE imagepost (
  postid INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  imageurl TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  caption TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  type TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE post_comments (
  commentid INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  postid INT NOT NULL,
  comment_text TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (postid) REFERENCES imagepost(postid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE post_likes (
  likeid INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  postid INT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (postid) REFERENCES imagepost(postid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE comment_likes (
  comment_like_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  commentid INT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (commentid) REFERENCES post_comments(commentid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE followers (
  followid INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  followerid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  followingid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (followerid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (followingid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE post_shares (
  shareid INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  sharerid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  sharedto VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  postid INT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (sharerid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (sharedto) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (postid) REFERENCES imagepost(postid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE otpmodel (
  phone_email VARCHAR(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  otp INT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  flag TINYINT(1) DEFAULT 0
);

CREATE TABLE story (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  storyUrl TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  type VARCHAR(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'image',
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE story_likes (
  likeid INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  userid VARCHAR(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  storyid INT NOT NULL,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (userid) REFERENCES users(userid) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (storyid) REFERENCES story(id) ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE messages (
  messageId BIGINT NOT NULL AUTO_INCREMENT,
  messageUid CHAR(36) NOT NULL,  -- unique UUID for message
  replyToMessageId BIGINT NULL,  -- references another messageId
  senderUUId CHAR(36) NOT NULL,
  recieverUUId CHAR(36) NOT NULL,
  type ENUM('text','image','video','audio','file') DEFAULT 'text',
  message TEXT,
  creationTime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  deliveryStatus TINYINT DEFAULT 0,
  isDeleted BOOLEAN DEFAULT FALSE,
  PRIMARY KEY (messageId),
  UNIQUE KEY uq_messageUid (messageUid),
  foreign key (senderUUId) references users(uuid) on delete cascade on update cascade,
  foreign key (recieverUUId) references users(uuid) on delete cascade on update cascade

)
